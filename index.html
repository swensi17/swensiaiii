<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI –ß–∞—Ç - AI Creative Hub</title>
    <link rel="stylesheet" href="styles/chat.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="chat-page">
    <div class="chat-wrapper">
        <!-- –®–∞–ø–∫–∞ —á–∞—Ç–∞ -->
        <header class="chat-header">
            <div class="header-content">
                <button class="settings-button" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">
                    <i class="fas fa-cog"></i>
                </button>
                <div class="model-selector">
                    <select id="modelSelect">
                        <option value="openai">OpenAI GPT-4o-mini</option>
                        <option value="openai-large" selected>OpenAI GPT-4o</option>
                        <option value="openai-reasoning">OpenAI o1-mini</option>
                        <option value="qwen-coder">Qwen 2.5 Coder 32B</option>
                        <option value="llama">Llama 3.3 70B</option>
                        <option value="mistral">Mistral Nemo</option>
                        <option value="unity">Unity with Mistral Large</option>
                        <option value="midijourney">Midijourney musical transformer</option>
                        <option value="rtist">Rtist image generator</option>
                        <option value="searchgpt">SearchGPT with realtime search</option>
                        <option value="evil">Evil Mode - Experimental</option>
                        <option value="deepseek">DeepSeek-V3</option>
                        <option value="claude-hybridspace">Claude Hybridspace</option>
                        <option value="deepseek-r1">DeepSeek-R1 Distill Qwen 32B</option>
                        <option value="deepseek-reasoner">DeepSeek R1 - Full</option>
                        <option value="llamalight">Llama 3.1 8B Instruct</option>
                        <option value="llamaguard">Llamaguard 7B AWQ</option>
                        <option value="gemini">Gemini 2.0 Flash</option>
                        <option value="gemini-thinking">Gemini 2.0 Flash Thinking</option>
                        <option value="hormoz">Hormoz 8b</option>
                        <option value="hypnosis-tracy">Hypnosis Tracy</option>
                        <option value="sur">Sur AI Assistant</option>
                        <option value="sur-mistral">Sur AI Assistant (Mistral)</option>
                        <option value="llama-scaleway">Llama (Scaleway)</option>
                    </select>
                </div>
                <button id="newChat" class="new-chat-btn">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
        </header>

        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å —á–∞—Ç–∞ -->
        <main class="chat-messages" id="chatMessages">
            <div class="message ai-message">
                <div class="message-content">
                    <div class="ai-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="message-text">–ü—Ä–∏–≤–µ—Ç! –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å? üòä</div>
                </div>
                <div class="message-actions">
                    <button class="action-btn copy-btn" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å">
                        <i class="fas fa-copy"></i>
                    </button>
                    <button class="action-btn regenerate-btn" title="–†–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å">
                        <i class="fas fa-redo"></i>
                    </button>
                    <button class="action-btn like-btn" title="–ù—Ä–∞–≤–∏—Ç—Å—è">
                        <i class="fas fa-thumbs-up"></i>
                    </button>
                    <button class="action-btn dislike-btn" title="–ù–µ –Ω—Ä–∞–≤–∏—Ç—Å—è">
                        <i class="fas fa-thumbs-down"></i>
                    </button>
                </div>
            </div>
        </main>

        <!-- –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å –≤–≤–æ–¥–∞ -->
        <footer class="chat-input-panel">
            <div class="input-container">
                <textarea id="userInput" placeholder="Message Text" rows="1"></textarea>
                <button id="sendMessage" class="send-button">
                    <i class="fas fa-arrow-up"></i>
                </button>
            </div>
        </footer>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
    <div id="settingsModal" class="settings-modal">
        <div class="settings-content">
            <div class="settings-header">
                <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
                <button class="close-settings">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="settings-body">
                <div class="settings-section">
                    <h3>–†–æ–ª–∏ –ò–ò</h3>
                    <div class="roles-grid">
                        <div class="role-card" data-role="assistant">
                            <i class="fas fa-robot"></i>
                            <h4>–û–±—ã—á–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç</h4>
                            <p>–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–µ–∂–∏–º –æ–±—â–µ–Ω–∏—è</p>
                        </div>
                        <div class="role-card" data-role="developer">
                            <i class="fas fa-code"></i>
                            <h4>–ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç</h4>
                            <p>–ü–æ–º–æ—â—å —Å –∫–æ–¥–æ–º –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–æ–π</p>
                        </div>
                        <div class="role-card" data-role="writer">
                            <i class="fas fa-pen-fancy"></i>
                            <h4>–ü–∏—Å–∞—Ç–µ–ª—å</h4>
                            <p>–ü–æ–º–æ—â—å —Å —Ç–µ–∫—Å—Ç–∞–º–∏ –∏ —Å—Ç–∞—Ç—å—è–º–∏</p>
                        </div>
                        <div class="role-card" data-role="teacher">
                            <i class="fas fa-graduation-cap"></i>
                            <h4>–£—á–∏—Ç–µ–ª—å</h4>
                            <p>–û–±—É—á–µ–Ω–∏–µ –∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ</p>
                        </div>
                        <div class="role-card" data-role="unrestricted">
                            <i class="fas fa-unlock"></i>
                            <h4>–ë–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π 18+</h4>
                            <p>–û–±—â–µ–Ω–∏–µ –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤</p>
                        </div>
                        <div class="role-card" data-role="creative">
                            <i class="fas fa-paint-brush"></i>
                            <h4>–ö—Ä–µ–∞—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º</h4>
                            <p>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–¥–µ–π –∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞</p>
                        </div>
                    </div>
                </div>
                <div class="settings-section">
                    <h3>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
                    <div class="settings-options">
                        <label class="switch-label">
                            <span>–ü–∞–º—è—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞</span>
                            <label class="switch">
                                <input type="checkbox" id="contextMemory" checked>
                                <span class="slider"></span>
                            </label>
                        </label>
                        <label class="switch-label">
                            <span>–ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞</span>
                            <label class="switch">
                                <input type="checkbox" id="autoScroll" checked>
                                <span class="slider"></span>
                            </label>
                        </label>
                        <label class="switch-label">
                            <span>–ó–≤—É–∫–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</span>
                            <label class="switch">
                                <input type="checkbox" id="soundNotifications">
                                <span class="slider"></span>
                            </label>
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="scripts/chat.js"></script>
    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –ø—Ä—è–º–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ AI
        const BASE_URL = "https://text.pollinations.ai";
        const DEFAULT_MODEL = "openai-large";
        let conversationHistory = [];

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä—è–º–æ–≥–æ –æ–±—â–µ–Ω–∏—è —Å AI
        async function directAIChat(messages, model = DEFAULT_MODEL) {
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
                const hasSystemMessage = messages.some(msg => msg.role === 'system');
                
                if (!hasSystemMessage) {
                    messages.unshift({
                        role: "system",
                        content: "–¢—ã –æ–±—ã—á–Ω—ã–π AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç. –û—Ç–≤–µ—á–∞–π —á–µ—Ç–∫–æ –∏ –ø–æ –¥–µ–ª—É, –±—É–¥—å –≤–µ–∂–ª–∏–≤—ã–º –∏ –ø–æ–ª–µ–∑–Ω—ã–º."
                    });
                }

                // –î–æ–±–∞–≤–ª—è–µ–º –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞
                const fullMessages = [...conversationHistory, ...messages];

                const response = await fetch(`${BASE_URL}/openai`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: model,
                        messages: fullMessages,
                        seed: Math.floor(Math.random() * 1000000)
                    })
                });

                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }

                const data = await response.json();
                const aiResponse = data.choices[0].message.content;

                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∏—Å—Ç–æ—Ä–∏—é
                messages.forEach(msg => {
                    if (msg.role !== 'system') {
                        conversationHistory.push(msg);
                    }
                });
                conversationHistory.push({
                    role: "assistant",
                    content: aiResponse
                });

                // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –ø–æ—Å–ª–µ–¥–Ω–∏–º–∏ 10 —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
                conversationHistory = conversationHistory.slice(-10);

                return {
                    response: aiResponse,
                    model: data.model || model
                };
            } catch (error) {
                console.error('Error in directAIChat:', error);
                return null;
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏
        function clearConversationHistory() {
            conversationHistory = [];
        }

        // –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é sendMessage –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä—è–º–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        const originalSendMessage = window.sendMessage;
        window.sendMessage = async function(message, isRegeneration = false, targetElement = null, previousContent = '') {
            try {
                if (isGenerating) return;
                toggleUI(true);

                if (!isRegeneration && !targetElement) {
                    messageHistory.push({ role: "user", content: message });
                    addMessage(message, true);
                }

                let messageText;
                let existingContent = '';
                
                if (targetElement) {
                    messageText = targetElement;
                    existingContent = previousContent || messageText.textContent;
                } else {
                    const aiMessageDiv = addMessage('', false);
                    const messageContent = aiMessageDiv.querySelector('.message-content');
                    const avatar = messageContent.querySelector('.ai-avatar');
                    avatar.insertAdjacentHTML('afterend', '<span class="typing-indicator">–ø–µ—á–∞—Ç–∞–µ—Ç</span>');
                    messageText = messageContent.querySelector('.message-text');
                }

                // –ü—Ä–æ–±—É–µ–º —Å–Ω–∞—á–∞–ª–∞ –ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
                const directResponse = await directAIChat([{ role: "user", content: message }], currentModel);
                
                if (directResponse) {
                    const aiResponse = directResponse.response;
                    
                    if (targetElement) {
                        const messageContent = messageText.closest('.message-content');
                        const typingIndicator = messageContent.querySelector('.typing-indicator');
                        if (typingIndicator) typingIndicator.remove();
                        
                        if (existingContent.includes('</code></pre>')) {
                            const lastCodeBlock = existingContent.lastIndexOf('</code></pre>');
                            const beforeCode = existingContent.substring(0, lastCodeBlock);
                            const codeMatch = existingContent.match(/<pre data-language="([^"]+)"><code[^>]*>/);
                            const language = codeMatch ? codeMatch[1] : 'text';
                            const formattedResponse = '```' + language + '\n' + aiResponse + '\n```';
                            const newContent = beforeCode + highlightCode(aiResponse, language) + '</code></pre>';
                            messageText.innerHTML = newContent;
                        } else {
                            const newContent = existingContent + '\n\n' + aiResponse;
                            messageText.innerHTML = formatMarkdown(newContent);
                        }
                        
                        if (messageHistory.length > 0) {
                            messageHistory[messageHistory.length - 1].content = messageText.textContent;
                        }
                    } else {
                        messageHistory.push({ role: "assistant", content: aiResponse });
                        const messageContent = messageText.closest('.message-content');
                        const typingIndicator = messageContent.querySelector('.typing-indicator');
                        if (typingIndicator) typingIndicator.remove();
                        messageText.innerHTML = formatMarkdown(aiResponse);
                    }
                } else {
                    // –ï—Å–ª–∏ –ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥
                    await originalSendMessage(message, isRegeneration, targetElement, previousContent);
                }
            } catch (error) {
                console.error('Error:', error);
                if (!targetElement) {
                    const lastAiMessage = chatMessages.querySelector('.ai-message:last-child');
                    if (lastAiMessage) {
                        lastAiMessage.remove();
                    }
                    showToast('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–ø—Ä–æ—Å–∞', 'error');
                }
            } finally {
                toggleUI(false);
            }
        };
    </script>
</body>
</html> 